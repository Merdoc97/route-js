var Route={map:function(a){if(Route._routes.defined.hasOwnProperty(a)){return Route._routes.defined[a]}else{return new Route._core.route(a)}},listen:function(){if(location.hash!==""){Route._dispatch()}if("onhashchange" in window){window.onhashchange=Route._dispatch}else{setInterval(Route._dispatch,50)}},resetAction:function(a){Route._routes.resetAction=a},_match:function(o,m){var d={},g,l,h,f,e,a;for(var k in Route._routes.defined){if(k===null||k===undefined){continue}k=Route._routes.defined[k];g=k._partition();for(e=0;e<g.length;e++){l=g[e];a=o;if(l.search(/\*|:/)>0){h=l.split("/");for(f=0;f<h.length;f++){if((f<a.split("/").length)&&(h[f][0]===":")){d[h[f].replace(/:/,"")]=a.split("/")[f];a=a.replace(a.split("/")[f],h[f])}if((f+1)==h.length&&h[f]==="*"&&a.split("/").length>=f){var c=a.split("/").slice(f);var b=0;while(true){if(c[b]===undefined){break}d[c[b]]=c[b+1];b=b+2}a=a.split("/").slice(0,f).join("/")+"/*"}}}if(l===a){if(m){k._params=d}return k}}}return null},_dispatch:function(){if(Route._routes.current!==location.hash){Route._routes.previous=Route._routes.current;Route._routes.current=location.hash;var b=Route._match(location.hash,true);if(Route._routes.previous){var a=Route._match(Route._routes.previous);if(a!==null&&a._afterAction!==null){a._afterAction()}}if(b!==null){b._run()}else{if(Route._routes.resetAction!==null){Route._routes.resetAction()}}}},_core:{route:function(a){this._path=a;this._action=[];this._params={};this._getParam=function(c,b){return typeof(this._params[c])!=="undefined"?this._params[c]:b};this._getAllParams=function(){return this._params};this._beforeAction=[];this._afterAction=null;Route._routes.defined[a]=this}},_routes:{current:null,previous:null,resetAction:null,defined:{}}};Route._core.route.prototype={to:function(a){this._action.push(a);return this},before:function(a){if(a instanceof Array){this._beforeAction=this._beforeAction.concat(a)}else{this._beforeAction.push(a)}return this},after:function(a){this._afterAction=a;return this},_partition:function(){var d=[],a=[],c=/\(([^}]+?)\)/g,e,b;while(e=c.exec(this._path)){d.push(e[1])}a.push(this._path.split("(")[0]);for(b=0;b<d.length;b++){a.push(a[a.length-1]+d[b])}return a},_run:function(){var f=false,b,a,c,d=Route._routes.defined[this._path];if(d.hasOwnProperty("_beforeAction")){if(d._beforeAction.length>0){for(b=0;b<d._beforeAction.length;b++){a=d._beforeAction[b]();if(a===false){f=true;break}}}}if(!f){for(var e in d._action){d._action[e].apply(d)}}}};